<html>
<a href="main.html">Back</a>
<h3>Item Distributions</h3>
Up to 8 chests are generated per floor.  For each chest, one of six categories of item is placed into each.  This is done by generating a random 8-bit value using the Ancient Cave random values table, and thresholding it against a bunch of different probability values.  The default values shown for these six options in the tool reflect the values used by the unmodified game; ie, selecting "Manual" and tapping "Up" on blue chests a few times will give you a normal-like set of items plus a few more blue chests.  The categories are as follows:
<ul>
<li>Weapons</li>
<li>Armor (this includes shields, rings, etc)</li>
<li>Spells (not sure yet whether this includes ALL spells)</li>
<li>"Blue chest" items, which include several specific weapons, armors, and accessories</li>
<li>Restorative consumables (AKA "Consumables 1")</li>
<li>Non-restorative consumables (AKA "Consumables 2")</li>
</ul>
and each of them is defined/handled as follows:
<br>
<h4>General</h4>
Item data relevant to Ancient Cave inclusion can be found at 0xB4F69 in the ROM, which is a table of 0x1D2 16-bit offsets pointing ahead to variable-sized blocks of data for each of the 0x1D2 items.  The data relevant to Ancient Cave includes:
<ul>
<li>Byte 0, bit 0x02 must be "on" for Ancient Cave inclusion.  The Derandomizer modifies this value to include or exclude items.</li>
<li>Byte 0, bit 0x20 must be "off" for Ancient Cave inclusion.  The Derandomizer modifies this value to include or exclude items.</li>
<li>Byte 1, bit 0x20 must be "off" for Ancient Cave inclusion.  The Derandomizer modifies this value to include or exclude items.</li>
<li>Bytes 5 and 6, forming a 16-bit item "gold value," are used to determine which items will come up on which floors.  An item's value must be less than (the current floor number + 1) * 1000 for it to show up on any given floor.  The Derandomizer modifies this value to make items show up sooner or later depending on the chosen settings.</li>
<li>Byte 7 indicates the item type.  The only relevant values here are whether this is 0x01 (indicating a weapon) or greater (indicating an armor).  Consumables are indicated by 00, but that value is not used here since consumables are handled differently.</li>
</ul>
<h4>1. Weapons</h4>
  Anything starting at ID 55 with an item type of 0x01 (this runs through ID 163) that is also marked for inclusion in Ancient Cave.
<h4>2. Non-Weapons</h4>
  Anything starting at ID 55 with an item type of 0x02 or above (this runs from ID 164 through the end of the items list) that is also marked for inclusion in Ancient Cave.
<h4>3. Spells</h4>
  More research is needed here.  There is probably a table of Ancient Cave spell IDs that this pulls from.
<h4>4. Blue Chests</h4>
  There is a table of 0x29 16-bit values at 0xA6EA0 in the ROM indicating all items that can pop up in blue chests.
<h4>5. Non-restorative consumables</h4>
  There is a table of 9 16-bit values at 0x8FFDC in the ROM indicating all items that can pop up in this category.
<h4>6. Restorative consumables</h4>
  There is a table of 0x1F 16-bit values at 0xA713D in the ROM indicating all items that can pop up in this category.  
</html>
